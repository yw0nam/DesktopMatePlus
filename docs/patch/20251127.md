# Release Notes - 2025-11-27

## [0.2.1](https://github.com/yw0nam/DesktopMatePlus/compare/992add5...b2f03ff) (2025-11-27)

> This release introduces comprehensive WebSocket documentation, image support for the agent and LTM systems, and improves the memory saving mechanism for better streaming performance.

### Upgrade Steps

* No action required. This release is backward compatible.

### Breaking Changes

* None

### New Features

* **Image Support in Chat Messages** - Added ability to include images in chat messages via WebSocket
  - New `LocalImageManager` class for processing and managing images within conversations
  - Agent configuration now supports image processing
  - LTM (Long-Term Memory) can now handle image data in memory contexts
  - WebSocket `chat_message` now accepts optional `images` field

* **Avatar & Background Management via WebSocket** - New WebSocket messages for managing Live2D avatars and backgrounds
  - `fetch_backgrounds` / `background_files` - Request and receive available background images
  - `fetch_avatar_configs` / `avatar_config_files` - Request and receive avatar configurations
  - `switch_avatar_config` / `avatar_config_switched` - Switch between avatar configurations
  - `set_model_and_conf` - Server message to set Live2D model and configuration

### Bug Fixes

* None

### Performance Improvements

* **Asynchronous Memory Saving** - Memory operations now run in background threads via `asyncio.to_thread()`, preventing TTS playback blocking
* **Non-blocking Stream End** - Client receives `stream_end` immediately after agent finishes, memory save runs asynchronously
* **Improved Response Streaming** - Enhanced streaming performance with better token buffering

### Other Changes

* **Documentation** - Comprehensive WebSocket API documentation
  - Updated `README.md` with WebSocket message tables
  - Created `API_GUIDE.md` for frontend integration overview
  - Updated `REST_API_GUIDE.md` with current endpoint information
  - Added individual documentation files for all 18 WebSocket message types
  - Updated `WEBSOCKET_API_GUIDE.md` with new message types

* **Configuration Updates**
  - Updated `.env.example` with new environment variables
  - Updated `.gitignore` patterns
  - Updated YAML configuration files for agent, LTM, and STM services

---

## Commits

| Hash | Message |
|------|---------|
| `b2f03ff` | feat: add WebSocket message documentation and improve memory saving mechanism |
| `103b3c4` | feat: add image support in agent and LTM configurations, enhance message handling for images, and implement LocalImageManager for image processing |

---

## Files Changed

### New Files

| File | Description |
|------|-------------|
| `src/services/stm_service/utils/image_manager.py` | LocalImageManager class |
| `docs/websocket/WebSocket_FetchBackgrounds.md` | Fetch backgrounds documentation |
| `docs/websocket/WebSocket_FetchAvatarConfigs.md` | Fetch avatar configs documentation |
| `docs/websocket/WebSocket_SwitchAvatarConfig.md` | Switch avatar config documentation |
| `docs/websocket/WebSocket_BackgroundFiles.md` | Background files response documentation |
| `docs/websocket/WebSocket_AvatarConfigFiles.md` | Avatar config files response documentation |
| `docs/websocket/WebSocket_AvatarConfigSwitched.md` | Avatar config switched documentation |
| `docs/websocket/WebSocket_SetModelAndConf.md` | Set model and conf documentation |

### Modified Files

| File | Description |
|------|-------------|
| `src/services/agent_service/openai_chat_agent.py` | Async memory saving |
| `src/services/agent_service/service.py` | Memory save improvements |
| `src/services/stm_service/mongodb.py` | Image handling support |
| `src/services/stm_service/service.py` | Image processing integration |
| `src/services/ltm_service/mem0_ltm.py` | Image context support |
| `src/services/vlm_service/service.py` | Enhanced VLM service |
| `src/services/vlm_service/utils.py` | VLM utilities update |
| `src/services/websocket_service/manager/handlers.py` | Image message handling |
| `src/configs/agent.py` | Image support config |
| `src/configs/ltm.py` | LTM image config |
| `src/models/websocket.py` | Updated message models |
| `yaml_files/services/agent_service/openai_chat_agent.yml` | Agent config |
| `yaml_files/services/ltm_service/mem0.yml` | LTM config |
| `yaml_files/services/stm_service/mongodb.yml` | STM config |
| `.env.example` | Environment variables |
| `.gitignore` | Ignore patterns |
| `README.md` | WebSocket message tables |
| `docs/API_GUIDE.md` | Frontend integration guide |
| `docs/api/REST_API_GUIDE.md` | REST API reference |
| `docs/websocket/WEBSOCKET_API_GUIDE.md` | WebSocket guide |
| `examples/realtime_tts_streaming_demo.py` | Demo script |
| `examples/USAGE_REFERENCE_VOICE.md` | Usage documentation |
