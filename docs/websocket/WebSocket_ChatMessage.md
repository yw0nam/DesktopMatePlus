# WebSocket: Chat Message

The `chat_message` is the primary message for interacting with the agent. It is sent by the client to ask a question or provide input.

## Direction

Client -> Server

## Payload

```json
{
    "type": "chat_message",
    "content": "Hello, what is the weather like in London today?",
    "agent_id": "yuri-assistant",
    "user_id": "user-123",
    "persona": "You are a helpful 3D desktop assistant...",
    "images": ["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA..."],
    "limit": 10,
    "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
    "metadata": {"source": "desktop_app"}
}
```

### Fields

- `type` (string, required): Must be `"chat_message"`.
- `content` (string, required): The user's input text.
- `agent_id` (string, required): Persistent agent identifier.
- `user_id` (string, required): Persistent user/client identifier.
- `persona` (string, optional): Persona or behavior profile for the agent. Defaults to a predefined Yuri assistant persona.
- `images` (array of strings, optional): Optional images included in the message, each as a URL or base64 string.
- `limit` (integer, optional): Optional limit for short-term memory messages. Defaults to 10.
- `conversation_id` (UUID string, optional): Persistent conversation identifier. If None, a new conversation will be created.
- `metadata` (object, optional): Additional metadata for the message.

## Usage

After a successful `authorize` handshake, the client can send `chat_message` objects to the server at any time. Each message initiates a "turn" where the agent processes the input and streams back a response.

The client should generate a `conversation_id` for the first message and then reuse it for all subsequent messages in that same conversation. The `agent_id` and `user_id` are required to identify the specific agent and user in the system.

## Example

```javascript
// Assuming the WebSocket 'socket' is connected and authorized

function sendMessage(content, conversationId, agentId, userId) {
    const chatMessage = {
        type: 'chat_message',
        content: content,
        agent_id: agentId,
        user_id: userId,
        conversation_id: conversationId,
        limit: 10
    };

    socket.send(JSON.stringify(chatMessage));
}

// Send a new message
sendMessage(
    "Tell me a fun fact about space.",
    null, // conversation_id will be generated by server
    "yuri-assistant",
    "user-123"
);
```
